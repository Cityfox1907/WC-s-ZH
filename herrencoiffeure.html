<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Z√ºriHub ‚Äì Herrencoiffeure Kanton Z√ºrich</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üíà</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Fraunces:opsz,wght@9..144,600;9..144,700;9..144,800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="design-tokens.css">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#F4F7FB;--surface:#FFFFFF;--surface2:#EBF0F7;--border:#D4DCE8;--border-light:#E8EDF5;
  --text:#0D1B2A;--text2:#4A5568;--text3:#8896A6;
  --primary:#0F47AF;--primary-light:#E8EEFB;--primary-lighter:#F2F5FC;--primary-dark:#0A3580;--primary-50:rgba(15,71,175,.06);
  --accent:#E63946;--accent-light:#FEF0F1;
  --gold:#D4930D;
  --radius:14px;--radius-sm:6px;
  --shadow:0 1px 3px rgba(13,27,42,.05),0 1px 2px rgba(13,27,42,.03);
  --shadow-md:0 4px 14px rgba(13,27,42,.08);--shadow-lg:0 12px 36px rgba(13,27,42,.12);
  --font:'Outfit',system-ui,sans-serif;--font-display:'Fraunces',Georgia,serif;
  --card-bg:#FFFFFF;--header-bg:rgba(255,255,255,.92);--sidebar-bg:#fff;
  --modal-bg:#fff;--modal-overlay:rgba(13,27,42,.35);
  --splash-bg:var(--primary);
  --barber:#8B4513;--barber-light:#FDF5EE;--barber-dark:#6B3410;
}

/* ‚îÄ‚îÄ DARK MODE ‚îÄ‚îÄ */
html.dark{
  --bg:#0f1b2d;--surface:#1a2a3a;--surface2:#1e3148;--border:#2a3f58;--border-light:#243650;
  --text:#e8ecf2;--text2:#a8b8cc;--text3:#6b7f96;
  --primary:#5a9cf5;--primary-light:#1e3148;--primary-lighter:#162538;--primary-dark:#7bb8ff;--primary-50:rgba(90,156,245,.08);
  --accent:#ff6b78;--accent-light:#2a1820;
  --gold:#f5a623;
  --shadow:0 1px 3px rgba(0,0,0,.2),0 1px 2px rgba(0,0,0,.15);
  --shadow-md:0 4px 14px rgba(0,0,0,.3);--shadow-lg:0 12px 36px rgba(0,0,0,.4);
  --card-bg:#1a2a3a;--header-bg:rgba(15,27,45,.92);--sidebar-bg:#152235;
  --modal-bg:#1a2a3a;--modal-overlay:rgba(5,10,20,.6);
  --splash-bg:#0f1b2d;
  --barber:#c9a06c;--barber-light:#2a2418;--barber-dark:#e0b87a;
}
html.dark input[type="range"]{background:var(--border)}
html.dark input[type="range"]::-webkit-slider-thumb{border-color:var(--surface)}
html.dark .card{background:var(--card-bg)}
html.dark .header{background:var(--header-bg)}
html.dark .sidebar{background:var(--sidebar-bg)}
html.dark .mp{background:var(--modal-bg)}
html.dark .mo{background:var(--modal-overlay)}
html.dark .hbtn{background:var(--surface);border-color:var(--border);color:var(--text2)}
html.dark .hbtn:hover{border-color:var(--primary);color:var(--primary)}
html.dark .tb{background:var(--surface);border-color:var(--border);color:var(--text2)}
html.dark .tb.on{background:var(--primary);color:#fff;border-color:var(--primary)}
html.dark .smenu{background:var(--surface);border-color:var(--border)}
html.dark .sopt:hover{background:var(--surface2)}
html.dark .mclose{background:rgba(26,42,58,.94)}
html.dark .search-box input{background:var(--surface2);border-color:var(--border);color:var(--text)}
html.dark .search-box input:focus{border-color:var(--primary);background:var(--surface);box-shadow:0 0 0 3px rgba(90,156,245,.15)}
html.dark .geo-input input{background:var(--surface2);border-color:var(--border);color:var(--text)}
html.dark .tag{background:var(--surface2);color:var(--text2)}
html.dark .pb{background:var(--surface);border-color:var(--border);color:var(--text2)}
html.dark .pb.on{background:var(--primary);color:#fff;border-color:var(--primary)}
html.dark .ltbl th{background:var(--surface2);color:var(--text3);border-bottom-color:var(--border)}
html.dark .ltbl td{border-bottom-color:var(--border-light)}
html.dark .ltbl tbody tr:nth-child(even){background:var(--primary-50)}
html.dark .ltbl tbody tr:hover{background:var(--primary-lighter)}
html.dark .btn-s{background:var(--surface);color:var(--text2);border-color:var(--border)}
html.dark .btn-s:hover{border-color:var(--primary);color:var(--primary)}
html.dark .chip{background:var(--primary-light);color:var(--primary-dark)}
html.dark .rank-badge{background:#e8914a;color:#fff;box-shadow:0 2px 8px rgba(232,145,74,.4)}
html.dark .rank-badge.top3{background:linear-gradient(135deg,#e8914a,#f5a623)}
html.dark .fav-star{color:#6b7f96}
html.dark .fav-star.active{color:#f5a623;text-shadow:0 0 8px rgba(245,166,35,.5)}
html.dark .filter-chip{background:var(--surface);border-color:var(--border);color:var(--text2)}
html.dark .filter-chip.on{background:var(--primary);color:#fff;border-color:var(--primary)}
html.dark .filter-chip:hover{border-color:var(--primary);color:var(--primary)}
html.dark .filter-section-label{color:var(--primary)}
html.dark .btn-maps{background:var(--surface2);border-color:var(--border);color:var(--text2)}
html.dark .btn-maps:hover{background:var(--surface);border-color:var(--primary);color:var(--primary)}
html.dark .open-badge{background:rgba(22,163,74,0.22);color:#4ade80}
html.dark .closed-badge{background:rgba(220,38,38,0.18);color:#f87171}

html{font-family:var(--font);background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased;overflow-x:hidden;transition:background .3s,color .3s}
body{min-height:100vh;overflow-x:hidden}
input,select,button,textarea{font-family:inherit;font-size:inherit}
button{cursor:pointer;border:none;background:none}
a{color:inherit;text-decoration:none}
::-webkit-scrollbar{width:5px;height:5px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
@keyframes slideIn{from{transform:translateX(100%)}to{transform:translateX(0)}}
@keyframes spin{to{transform:rotate(360deg)}}
.fade-up{animation:fadeUp .4s ease both}

/* SPLASH */
#splash{position:fixed;inset:0;background:var(--splash-bg);z-index:9999;display:flex;flex-direction:column;align-items:center;justify-content:center;color:#fff;transition:opacity .5s,visibility .5s}
#splash.done{opacity:0;visibility:hidden}
#splash::before{content:'';position:absolute;top:0;right:0;width:50%;height:100%;background:rgba(255,255,255,.06);clip-path:polygon(30% 0,100% 0,100% 100%,0 100%)}
.splash-logo{font-family:var(--font-display);font-size:clamp(2rem,5vw,3rem);font-weight:800;position:relative;z-index:1}
.splash-sub{font-size:.95rem;opacity:.7;margin-top:.5rem;position:relative;z-index:1}
.splash-spinner{width:28px;height:28px;border:3px solid rgba(255,255,255,.2);border-top-color:#fff;border-radius:50%;animation:spin .65s linear infinite;margin-top:2rem;position:relative;z-index:1}
.splash-msg{font-size:.85rem;opacity:.6;margin-top:1rem;position:relative;z-index:1}
.splash-bar{width:200px;height:3px;background:rgba(255,255,255,.15);border-radius:2px;overflow:hidden;margin-top:.75rem;position:relative;z-index:1}
.splash-bar-inner{height:100%;width:0%;background:#fff;border-radius:2px;transition:width .3s}
.splash-upload{display:none;margin-top:1.5rem;position:relative;z-index:1;text-align:center}
.splash-upload.show{display:block}
.drop-zone{width:340px;max-width:90vw;border:2px dashed rgba(255,255,255,.35);border-radius:14px;padding:2rem 1.5rem;cursor:pointer;transition:all .25s;position:relative;background:rgba(255,255,255,.06)}
.drop-zone:hover,.drop-zone.over{border-color:rgba(255,255,255,.7);background:rgba(255,255,255,.12);transform:scale(1.02)}
.drop-zone input{position:absolute;inset:0;opacity:0;cursor:pointer}
.drop-icon{font-size:2.2rem;margin-bottom:.5rem;display:block}
.drop-text{font-size:.9rem;opacity:.85;line-height:1.6}
.drop-hint{font-size:.75rem;opacity:.45;margin-top:.4rem}

/* HEADER */
.header{position:sticky;top:0;z-index:100;background:var(--header-bg);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-bottom:1px solid var(--border-light);padding:.55rem 1.25rem;transition:background .3s}
.header-inner{max-width:1480px;margin:0 auto;display:flex;align-items:center;gap:.75rem;flex-wrap:wrap}
.logo{font-family:var(--font-display);font-size:1.25rem;font-weight:800;color:var(--primary);white-space:nowrap;flex-shrink:0;letter-spacing:-.02em;display:inline-flex;align-items:center;gap:.4rem;text-decoration:none}
.logo-icon{flex-shrink:0;display:block}
.search-box{flex:1;min-width:180px;max-width:460px;position:relative}
.search-box input{width:100%;padding:.5rem .85rem .5rem 2.2rem;border:1.5px solid var(--border);border-radius:var(--radius);background:var(--bg);font-size:.87rem;transition:all .2s;outline:none;color:var(--text)}
.search-box input:focus{border-color:var(--primary);background:var(--surface);box-shadow:0 0 0 3px rgba(15,71,175,.1)}
.search-box input::placeholder{color:var(--text3)}
.search-box svg{position:absolute;left:.7rem;top:50%;transform:translateY(-50%);color:var(--text3);pointer-events:none}
.hactions{display:flex;gap:.35rem;align-items:center;margin-left:auto;flex-wrap:wrap}
.hbtn{padding:.42rem .7rem;border-radius:var(--radius-sm);font-size:.8rem;font-weight:500;color:var(--text2);border:1.5px solid var(--border);background:var(--surface);transition:all .18s;display:inline-flex;align-items:center;gap:.3rem;white-space:nowrap}
.hbtn:hover{border-color:var(--primary);color:var(--primary)}
.hbtn svg{width:15px;height:15px;flex-shrink:0}

/* ‚îÄ‚îÄ VIEW TOGGLE ‚îÄ‚îÄ */
.view-toggle{position:relative;width:58px;height:28px;border-radius:14px;background:var(--border);cursor:pointer;border:1.5px solid var(--border);transition:all .3s;flex-shrink:0;display:flex;align-items:center}
.view-toggle .vt-knob{position:absolute;left:2px;width:22px;height:22px;border-radius:50%;background:#fff;box-shadow:0 1px 4px rgba(0,0,0,.15);transition:transform .3s cubic-bezier(.4,.0,.2,1);display:flex;align-items:center;justify-content:center;z-index:2}
.view-toggle .vt-knob svg{width:13px;height:13px;color:var(--primary)}
.view-toggle .vt-icon{position:absolute;font-size:.7rem;transition:opacity .25s;display:flex;align-items:center;justify-content:center}
.view-toggle .vt-icon-grid{left:6px;opacity:.5;color:var(--text3)}
.view-toggle .vt-icon-list{right:6px;opacity:.5;color:var(--text3)}
.view-toggle.list-active .vt-knob{transform:translateX(30px)}
html.dark .view-toggle{background:var(--surface);border-color:var(--border)}
html.dark .view-toggle .vt-knob{background:#e8ecf2}

/* ‚îÄ‚îÄ THEME TOGGLE ‚îÄ‚îÄ */
.theme-toggle{position:relative;width:52px;height:28px;border-radius:14px;background:var(--border);cursor:pointer;border:1.5px solid var(--border);transition:all .3s;flex-shrink:0;display:flex;align-items:center}
.theme-toggle .toggle-knob{position:absolute;left:2px;width:22px;height:22px;border-radius:50%;background:#fff;box-shadow:0 1px 4px rgba(0,0,0,.15);transition:transform .3s cubic-bezier(.4,.0,.2,1);display:flex;align-items:center;justify-content:center;font-size:.7rem}
.theme-toggle .toggle-icon-sun,.theme-toggle .toggle-icon-moon{position:absolute;font-size:.75rem;transition:opacity .25s}
.theme-toggle .toggle-icon-sun{right:6px;opacity:1}
.theme-toggle .toggle-icon-moon{left:6px;opacity:0}
html.dark .theme-toggle{background:#1e3148;border-color:#2a3f58}
html.dark .theme-toggle .toggle-knob{transform:translateX(24px);background:#e8914a}
html.dark .theme-toggle .toggle-icon-sun{opacity:0}
html.dark .theme-toggle .toggle-icon-moon{opacity:1}

/* STATS */
.stats{max-width:1480px;margin:0 auto;padding:.45rem 1.25rem;display:flex;align-items:center;gap:.6rem;flex-wrap:wrap;font-size:.82rem;color:var(--text2)}
.rcnt b{color:var(--primary);font-weight:700}
.chips{display:flex;flex-wrap:wrap;gap:.3rem;align-items:center}
.chip{display:inline-flex;align-items:center;gap:.15rem;padding:.18rem .45rem;background:var(--primary-light);color:var(--primary-dark);border-radius:20px;font-size:.74rem;font-weight:500;white-space:nowrap}
.chip-x{display:inline-flex;align-items:center;justify-content:center;width:16px;height:16px;border-radius:50%;color:var(--primary-dark);opacity:.5;transition:all .12s;cursor:pointer;font-size:.68rem;border:none;background:none;padding:0;font-family:inherit;line-height:1}
.chip-x:hover{opacity:1;background:rgba(15,71,175,.15)}
.chip-clear{font-size:.74rem;color:var(--accent);font-weight:600;padding:.18rem .4rem;border-radius:var(--radius-sm);transition:background .12s}
.chip-clear:hover{background:var(--accent-light)}

/* LAYOUT */
.layout{max-width:1480px;margin:0 auto;display:flex;position:relative;overflow-x:hidden}
.fov{position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:149;display:none}.fov.on{display:block}

/* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */
.sidebar{width:280px;min-width:280px;border-right:1px solid var(--border-light);background:var(--sidebar-bg);padding:.75rem 1rem;overflow-y:auto;max-height:calc(100vh - 102px);position:sticky;top:102px;transition:transform .3s,background .3s}
.fs{margin-bottom:.85rem;padding-bottom:.85rem;border-bottom:1px solid var(--border-light)}.fs:last-child{border-bottom:none}
.fl{font-size:.72rem;font-weight:700;text-transform:uppercase;letter-spacing:.06em;color:var(--text3);margin-bottom:.45rem;display:flex;align-items:center;justify-content:space-between}

/* ‚îÄ‚îÄ Filter section labels ‚îÄ‚îÄ */
.filter-section-label{font-size:.8rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;color:var(--primary);padding:.5rem 0;display:flex;align-items:center;justify-content:space-between;cursor:pointer;user-select:none;border:none;background:none;width:100%;border-bottom:1px solid #e5e7eb;margin-bottom:.35rem}
.filter-section-label::after{content:'‚ñ∏';font-size:.75rem;transition:transform .25s;color:var(--text3)}
.filter-section-label.open::after{content:'‚ñæ'}
.filter-section-body{display:none;padding-bottom:.45rem}
.filter-section-body.open{display:block}
html.dark .filter-section-label{border-bottom-color:var(--border)}

/* ‚îÄ‚îÄ Filter chips grid ‚îÄ‚îÄ */
.filter-chips-grid{display:grid;grid-template-columns:1fr 1fr;gap:.4rem}
.filter-chip{padding:.28rem .45rem;border-radius:8px;font-size:.73rem;font-weight:500;border:1.5px solid var(--border);color:var(--text2);background:var(--surface);transition:all .15s;text-align:center;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;cursor:pointer;display:block;width:100%}
.filter-chip:hover{border-color:var(--primary);color:var(--primary);background:var(--primary-lighter)}
.filter-chip.on{background:var(--primary);color:#fff;border-color:var(--primary)}
.filter-chip .chip-count{font-size:.62rem;opacity:.5;margin-left:.15rem}

/* Legacy tag buttons */
.tg{display:flex;flex-wrap:wrap;gap:.28rem}
.tb{padding:.22rem .5rem;border-radius:20px;font-size:.74rem;border:1.5px solid var(--border);color:var(--text2);background:var(--surface);transition:all .15s;white-space:nowrap;line-height:1.4}
.tb:hover{border-color:var(--primary);color:var(--primary)}
.tb.on{background:var(--primary);color:#fff;border-color:var(--primary)}
.rng{margin-bottom:.35rem}
.rng label{font-size:.78rem;color:var(--text2);display:flex;justify-content:space-between;margin-bottom:.2rem}
.rng label b{font-weight:700;color:var(--primary)}
input[type="range"]{-webkit-appearance:none;width:100%;height:4px;border-radius:2px;background:var(--border);outline:none;margin:.25rem 0}
input[type="range"]::-webkit-slider-thumb{-webkit-appearance:none;width:16px;height:16px;border-radius:50%;background:var(--primary);cursor:pointer;border:2.5px solid var(--surface);box-shadow:0 1px 4px rgba(0,0,0,.15)}
.rpre{display:flex;flex-wrap:wrap;gap:.22rem;margin-top:.3rem}

/* CONTENT */
.content{flex:1;padding:.75rem 1.25rem;min-width:0;overflow-x:hidden}

/* ‚îÄ‚îÄ GRID ‚îÄ‚îÄ */
.grid{display:grid;grid-template-columns:1fr;gap:.85rem;overflow:visible;padding-top:4px;align-items:stretch;max-width:900px;margin:0 auto}
@media(min-width:768px){.grid{grid-template-columns:repeat(2,1fr)}}

/* ‚îÄ‚îÄ CARD ‚îÄ‚îÄ */
.card{background:var(--card-bg);border:1.5px solid var(--border-light);border-radius:14px;padding:.95rem 1rem;cursor:pointer;transition:all .2s;display:flex;flex-direction:column;position:relative;overflow:hidden;height:100%;min-height:0}
.card:hover{box-shadow:0 6px 24px rgba(15,71,175,0.13);border-color:rgba(15,71,175,0.25);transform:translateY(-2px)}
.card-header{display:flex;align-items:center;gap:1.1rem;margin-bottom:.55rem;flex-shrink:0}
.card-main-row{display:flex;flex-direction:row;align-items:flex-start;gap:.85rem;margin-bottom:.65rem}
.card-content{flex:1;min-width:0;display:flex;flex-direction:column;gap:.22rem}
.card-name{font-weight:700;font-size:1.1rem;line-height:1.3;color:var(--text);display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;white-space:normal}
.card-addr{font-size:.875rem;color:var(--text2);display:flex;align-items:flex-start;gap:.25rem;line-height:1.4;flex-wrap:wrap}
.card-addr svg{width:13px;height:13px;color:var(--text3);flex-shrink:0;margin-top:.15rem}
.card-addr-text{word-break:break-word}
.card-rating{display:flex;align-items:center;gap:.4rem;margin-top:.1rem}
.stars{display:inline-flex;gap:1px;color:var(--gold)}.stars svg{width:13px;height:13px}.stars .e{color:var(--border)}
.card-score{font-weight:700;font-size:.9rem;color:var(--text)}.card-reviews{font-size:.8rem;color:var(--text3)}
.card-footer{display:flex;align-items:center;justify-content:space-between;margin-top:auto;padding-top:.55rem;border-top:1px solid var(--border-light);gap:.5rem}
.card-tags{display:flex;flex-wrap:wrap;gap:.3rem;flex:1;min-width:0;align-items:center}
.tag{padding:.15rem .5rem;border-radius:12px;font-size:.8rem;font-weight:500;background:var(--surface2);color:var(--text2);white-space:nowrap}
.kreis{display:inline-flex;align-items:center;padding:.1rem .35rem;border-radius:6px;font-size:.62rem;font-weight:700;background:var(--primary);color:#fff;white-space:nowrap;letter-spacing:.03em;flex-shrink:0}
.dist{display:inline-flex;align-items:center;gap:.15rem;padding:.1rem .38rem;border-radius:6px;font-size:.62rem;font-weight:700;background:var(--gold);color:#fff;white-space:nowrap;flex-shrink:0;letter-spacing:.01em}
.dist svg{width:10px;height:10px}

/* ‚îÄ‚îÄ Open/Closed badges ‚îÄ‚îÄ */
.open-badge{display:inline-flex;align-items:center;gap:.2rem;padding:.15rem .5rem;border-radius:12px;font-size:.72rem;font-weight:600;background:rgba(22,163,74,0.12);color:#16a34a;white-space:nowrap}
.closed-badge{display:inline-flex;align-items:center;gap:.2rem;padding:.15rem .5rem;border-radius:12px;font-size:.72rem;font-weight:600;background:rgba(220,38,38,0.10);color:#dc2626;white-space:nowrap}

/* ‚îÄ‚îÄ Card icon ‚îÄ‚îÄ */
.card-icon{width:46px;height:46px;min-width:46px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.35rem;flex-shrink:0;background:linear-gradient(135deg,#FDF5EE,#F5E6D3)}
html.dark .card-icon{background:linear-gradient(135deg,#2a2418,#3a3020)}

/* ‚îÄ‚îÄ Google Maps Button ‚îÄ‚îÄ */
.btn-maps{display:inline-flex;align-items:center;gap:.3rem;padding:.3rem .6rem;border-radius:7px;background:#fff;border:1.5px solid #dadce0;text-decoration:none;font-size:.72rem;font-weight:600;color:#3c4043;white-space:nowrap;flex-shrink:0;transition:all .18s;box-shadow:0 1px 3px rgba(0,0,0,0.08)}
.btn-maps:hover{background:#f8f9fa;border-color:#bdc1c6;box-shadow:0 2px 6px rgba(0,0,0,0.12)}

/* Geo input */
.geo-input{display:flex;gap:.3rem;margin-bottom:.4rem;align-items:center}
.geo-input input{flex:1;padding:.38rem .4rem;border:1.5px solid var(--border);border-radius:var(--radius-sm);font-size:.82rem;text-align:center;outline:none;background:var(--bg);transition:border-color .15s;letter-spacing:.08em;font-weight:600;color:var(--text)}
.geo-input input:focus{border-color:var(--primary);background:var(--surface)}
.geo-input input.err{border-color:var(--accent);background:var(--accent-light)}
.geo-input input.ok{border-color:#0D8A4A;background:#ECFDF3}
.geo-hint{font-size:.68rem;color:var(--text3);margin-bottom:.35rem}
.geo-active{font-size:.72rem;color:var(--primary);font-weight:600;margin-bottom:.35rem;display:flex;align-items:center;gap:.25rem}
.geo-active button{font-size:.68rem;color:var(--accent);font-weight:600;margin-left:auto}

/* ‚îÄ‚îÄ RANK BADGE ‚îÄ‚îÄ */
.rank-badge{display:inline-flex;align-items:center;justify-content:center;padding:.18rem .55rem;border-radius:6px;background:linear-gradient(135deg,#e8a020,#d4930d);color:#fff;font-size:.72rem;font-weight:800;letter-spacing:.02em;box-shadow:0 2px 6px rgba(212,147,13,0.35);position:static;width:auto;height:auto;line-height:1}
.rank-badge.top3{background:linear-gradient(135deg,#e8a020,#d4930d);box-shadow:0 2px 8px rgba(212,147,13,0.5);padding:.2rem .6rem;font-size:.75rem}

/* ‚îÄ‚îÄ FAVORITE STAR ‚îÄ‚îÄ */
.fav-star{position:absolute;top:.55rem;right:.55rem;font-size:1.25rem;cursor:pointer;color:var(--text3);opacity:.5;transition:all .2s;z-index:3;line-height:1;padding:.15rem}
.fav-star:hover{opacity:1;transform:scale(1.2)}
.fav-star.active{color:var(--gold);opacity:1;text-shadow:0 0 6px rgba(212,147,13,.3)}

/* ‚îÄ‚îÄ BACK TO TOP ‚îÄ‚îÄ */
.btt{position:fixed;bottom:1.5rem;right:1.5rem;width:44px;height:44px;border-radius:50%;background:var(--primary);color:#fff;font-size:1.1rem;display:flex;align-items:center;justify-content:center;box-shadow:var(--shadow-md);cursor:pointer;border:none;z-index:90;opacity:0;visibility:hidden;transform:translateY(10px);transition:all .3s}
.btt.show{opacity:1;visibility:visible;transform:translateY(0)}
.btt:hover{background:var(--primary-dark);transform:translateY(-2px);box-shadow:var(--shadow-lg)}
html.dark .btt{background:#e8914a}
html.dark .btt:hover{background:#d17f3a}

/* LIST VIEW */
.lview{display:none;overflow-x:auto}
.ltbl{width:100%;border-collapse:separate;border-spacing:0;font-size:.78rem}
.ltbl th{background:var(--surface2);padding:.25rem .15rem;text-align:left;font-weight:600;font-size:.7rem;text-transform:uppercase;letter-spacing:.04em;color:var(--text3);border-bottom:2px solid var(--border);user-select:none;white-space:nowrap}
.ltbl th.sort{cursor:pointer}
.ltbl th.sort:hover{color:var(--primary)}
.ltbl th .sa{margin-left:.15rem;opacity:.3;font-size:.65rem}
.ltbl th.sd .sa{opacity:1;color:var(--primary)}
.ltbl td{padding:.2rem .15rem;border-bottom:1px solid var(--border-light);vertical-align:middle}
.ltbl tr{transition:background .1s}
.ltbl tbody tr:hover{background:var(--primary-lighter)}
.ltbl tbody tr:nth-child(even){background:var(--primary-50)}
.ltbl tbody tr:nth-child(even):hover{background:var(--primary-lighter)}
.ltbl .nc{font-weight:600;cursor:pointer;color:var(--primary);max-width:220px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.ltbl .nc:hover{text-decoration:underline}
.ltbl .ac{color:var(--text2);max-width:180px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.ltbl .link-cell a{color:var(--primary);font-weight:500;font-size:.78rem}
.ltbl .link-cell a:hover{text-decoration:underline}

/* PAGINATION */
.pag{display:flex;align-items:center;justify-content:center;gap:.35rem;margin:1.5rem 0 1rem;flex-wrap:wrap}
.pb{min-width:34px;height:34px;padding:0 .5rem;display:flex;align-items:center;justify-content:center;border-radius:var(--radius-sm);font-size:.82rem;font-weight:500;border:1.5px solid var(--border);color:var(--text2);background:var(--surface);transition:all .15s}
.pb:hover{border-color:var(--primary);color:var(--primary)}
.pb.on{background:var(--primary);color:#fff;border-color:var(--primary)}
.pb:disabled{opacity:.25;pointer-events:none}
.pi{font-size:.78rem;color:var(--text3);padding:0 .35rem}

/* MODAL */
.mo{position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:200;display:none;justify-content:flex-end}
.mo.on{display:flex}
.mp{width:500px;max-width:100vw;height:100vh;background:var(--modal-bg);overflow-y:auto;animation:slideIn .28s ease;box-shadow:-6px 0 30px rgba(0,0,0,.1);transition:background .3s}
.mclose{position:sticky;top:0;z-index:10;display:flex;justify-content:space-between;align-items:center;padding:.55rem .85rem;background:rgba(255,255,255,.94);backdrop-filter:blur(10px);border-bottom:1px solid var(--border-light);transition:background .3s}
.mclose .mtitle{font-weight:600;font-size:.85rem;color:var(--text3)}
.mclose button{width:32px;height:32px;border-radius:50%;background:var(--surface2);display:flex;align-items:center;justify-content:center;transition:background .15s}
.mclose button:hover{background:var(--border)}
.mbody{padding:1.25rem}
.m-name{font-family:var(--font-display);font-size:1.35rem;font-weight:700;margin-bottom:.35rem;line-height:1.25}
.m-sec{margin-bottom:1.1rem}
.m-sec h4{font-size:.72rem;font-weight:700;text-transform:uppercase;letter-spacing:.06em;color:var(--text3);margin-bottom:.4rem}
.m-row{display:flex;align-items:center;gap:.4rem;font-size:.85rem;color:var(--text2);margin-bottom:.3rem}
.m-row svg{width:15px;height:15px;color:var(--text3);flex-shrink:0}
.m-cta{display:flex;gap:.5rem;margin-top:1.25rem;flex-wrap:wrap}
.m-cta a{display:inline-flex;align-items:center;gap:.3rem;padding:.5rem 1rem;border-radius:var(--radius);font-size:.85rem;font-weight:500;transition:all .18s;text-decoration:none}
.btn-p{background:var(--primary);color:#fff}.btn-p:hover{background:var(--primary-dark)}
.btn-s{background:var(--surface);color:var(--text2);border:1.5px solid var(--border)}.btn-s:hover{border-color:var(--primary);color:var(--primary)}

/* Opening hours in modal */
.hours-list{list-style:none;font-size:.82rem;color:var(--text2)}
.hours-list li{padding:.2rem 0;display:flex;justify-content:space-between;border-bottom:1px solid var(--border-light)}
.hours-list li:last-child{border-bottom:none}
.hours-list .today{font-weight:700;color:var(--primary)}

/* Dropdowns */
.sdrop{position:relative}
.smenu{position:absolute;top:100%;right:0;margin-top:.3rem;background:var(--surface);border:1.5px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow-lg);padding:.25rem;min-width:195px;z-index:50;display:none;max-height:calc(100vh - 120px);overflow-y:auto}
.smenu.on{display:block}
.sopt{padding:.4rem .65rem;border-radius:var(--radius-sm);font-size:.8rem;color:var(--text2);display:flex;align-items:center;gap:.3rem;width:100%;text-align:left;transition:background .1s}
.sopt:hover{background:var(--surface2)}.sopt.on{color:var(--primary);font-weight:600}
.empty{text-align:center;padding:3.5rem 2rem;color:var(--text3)}
.empty .ei{font-size:2.5rem;margin-bottom:.5rem;display:block}

/* MOBILE */
.mfbtn{display:none!important}
@media(max-width:900px){
  .sidebar{position:fixed;left:0;top:0;width:280px;min-width:280px;height:100vh;height:100dvh;z-index:150;transform:translateX(-100%);box-shadow:var(--shadow-lg);overflow-y:auto;-webkit-overflow-scrolling:touch;padding-top:calc(env(safe-area-inset-top, 0px) + 1rem);padding-bottom:calc(2rem + env(safe-area-inset-bottom, 2rem));max-height:none;border-right:none}.sidebar.open{transform:translateX(0)}.mfbtn{display:inline-flex!important}.content{padding:.6rem .75rem}
}
@media(max-width:640px){
  .header-inner{gap:.35rem}.search-box{max-width:100%;order:10;min-width:100%}.hactions{width:100%;order:11;overflow-x:hidden;flex-wrap:nowrap;gap:.25rem;display:flex;justify-content:space-between}.stats{padding:.35rem .75rem;font-size:.77rem}.mp{width:100%}.grid{gap:.65rem}
  .theme-toggle{flex-shrink:0}
  .card-main-row{gap:.6rem;margin-bottom:.5rem}
  .card-footer{padding-top:.45rem}
  .btn-maps{font-size:.68rem;padding:.25rem .5rem}
  .hbtn{padding:.35rem .45rem;font-size:.75rem;gap:.2rem;min-width:44px;min-height:44px;justify-content:center;flex-shrink:1}
  .hbtn .btn-label{display:none}
  .view-toggle{width:52px;height:28px}
  .theme-toggle{width:48px;height:28px}
}
@media(min-width:401px) and (max-width:640px){
  .hbtn .btn-label{display:inline}
  .hbtn{padding:.35rem .55rem}
}
</style>
</head>
<body>
<div id="splash">
  <div class="splash-logo">üíà Z√ºriHub</div>
  <div class="splash-sub">Herrencoiffeure ¬∑ Kanton Z√ºrich</div>
  <div class="splash-spinner" id="splashSpinner"></div>
  <div class="splash-msg" id="splashMsg">Datenbank wird geladen‚Ä¶</div>
  <div class="splash-bar" id="splashBarWrap"><div class="splash-bar-inner" id="pbar"></div></div>
  <div class="splash-upload" id="splashUpload">
    <div class="drop-zone" id="dropZone">
      <input type="file" accept=".json" id="fileInput">
      <span class="drop-icon">üìÇ</span>
      <div class="drop-text"><b>barbershops_zuerich.json</b> hierher ziehen<br>oder klicken zum Ausw√§hlen</div>
      <div class="drop-hint">Wird ben√∂tigt wenn nicht auf GitHub Pages gehostet</div>
    </div>
  </div>
</div>

<div id="app" style="display:none">
  <header class="header"><div class="header-inner">
    <a href="index.html" class="logo"><svg class="logo-icon" width="28" height="28" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="4" y="4" width="92" height="92" rx="20" fill="currentColor" opacity=".08" stroke="currentColor" stroke-width="4"/><path d="M30 82V42l-4-2V38l12-14h2l2 5h16l2-5h2l12 14v2l-4 2v40" stroke="currentColor" stroke-width="4.5" stroke-linecap="round" stroke-linejoin="round"/><rect x="35" y="40" width="10" height="42" rx="1.5" stroke="currentColor" stroke-width="3.5"/><rect x="55" y="40" width="10" height="42" rx="1.5" stroke="currentColor" stroke-width="3.5"/><circle cx="40" cy="30" r="3.5" fill="currentColor"/><circle cx="60" cy="30" r="3.5" fill="currentColor"/><line x1="26" y1="82" x2="74" y2="82" stroke="currentColor" stroke-width="4" stroke-linecap="round"/><line x1="82" y1="12" x2="18" y2="88" stroke="#1a73e8" stroke-width="3" stroke-linecap="round" opacity=".18"/></svg>Z√ºriHub</a>
    <div class="search-box">
      <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
      <input type="text" id="si" placeholder="Name, Adresse, Keyword‚Ä¶" autocomplete="off">
    </div>
    <div class="hactions">
      <button class="hbtn mfbtn" onclick="toggleMF()"><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg><span class="btn-label">Filter</span></button>
      <div class="view-toggle" id="viewToggle" onclick="toggleView()" title="Kachel-/Listenansicht">
        <span class="vt-icon vt-icon-grid"><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg></span>
        <span class="vt-icon vt-icon-list"><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><circle cx="3.5" cy="6" r="1" fill="currentColor"/><circle cx="3.5" cy="12" r="1" fill="currentColor"/><circle cx="3.5" cy="18" r="1" fill="currentColor"/></svg></span>
        <div class="vt-knob"><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" id="vtKnobIcon"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg></div>
      </div>
      <div class="sdrop"><button class="hbtn" onclick="toggleSort(event)"><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 5h10M11 9h7M11 13h4M3 17l3 3 3-3M6 18V4"/></svg><span class="btn-label">Sortieren</span></button><div class="smenu" id="sortMenu"></div></div>
      <a href="favoriten.html" class="hbtn" title="Favoriten">‚≠ê <span class="btn-label">Favoriten</span></a>
      <div class="theme-toggle" onclick="toggleTheme()" title="Hell/Dunkel umschalten">
        <span class="toggle-icon-sun">‚òÄÔ∏è</span>
        <span class="toggle-icon-moon">üåô</span>
        <div class="toggle-knob"></div>
      </div>
    </div>
  </div></header>

  <div class="stats"><div class="rcnt" id="rcnt"></div><div class="chips" id="chips"></div></div>

  <div class="layout">
    <div class="fov" id="fov" onclick="toggleMF()"></div>
    <aside class="sidebar" id="sidebar">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:.6rem"><span style="font-weight:700;font-size:.9rem">üíà Filter</span><button class="chip-clear" onclick="clearAll()">Zur√ºcksetzen</button></div>

      <!-- Jetzt ge√∂ffnet -->
      <div class="fs">
        <div class="fl">√ñffnungsstatus</div>
        <div class="tg" style="gap:.35rem">
          <button id="btnOpen" class="tb" onclick="toggleOpen()" style="flex:1;justify-content:center;font-weight:600">üü¢ Jetzt ge√∂ffnet</button>
        </div>
      </div>

      <!-- Standort -->
      <div class="fs">
        <div class="fl">Standort</div>
        <div class="tg" style="gap:.35rem">
          <button id="btnStadtZh" class="tb" onclick="toggleStadtZh()" style="flex:1;justify-content:center;font-weight:600">üèôÔ∏è Stadt Z√ºrich</button>
        </div>
      </div>

      <!-- Umkreis -->
      <div class="fs" id="fGeo">
        <div class="fl">Umkreis-Suche</div>
        <div id="geoStatus"></div>
        <div class="geo-input"><input type="text" id="geoPlz" placeholder="PLZ eingeben" maxlength="4" inputmode="numeric" pattern="[0-9]*"></div>
        <div class="geo-hint" id="geoHint">PLZ eingeben, dann Radius w√§hlen</div>
        <div class="tg" id="geoRadius"></div>
      </div>

      <!-- Bewertung -->
      <div class="fs">
        <div class="fl">Bewertung</div>
        <div class="rng"><label>Mindestbewertung <b id="ratingVal">4.5</b></label><input type="range" min="4.5" max="5" step="0.1" value="4.5" id="ratingSlider" oninput="onRating(this.value)"></div>
        <div class="rng" style="margin-top:.5rem"><label>Min. Bewertungen <b id="revVal">10</b></label><input type="range" min="0" max="100" value="0" id="revSlider" oninput="onRevCount(this.value)"></div>
        <div class="rpre" id="revPresets"></div>
      </div>

      <!-- Services / Types filter -->
      <div class="fs" id="fTypes">
        <button class="filter-section-label open" id="lblTypes">Services</button>
        <div class="filter-section-body open">
          <div class="filter-chips-grid" id="fTypesGrid"></div>
        </div>
      </div>
    </aside>
    <main class="content">
      <div class="grid" id="grid"></div>
      <div class="lview" id="lview"><table class="ltbl"><thead id="lhead"></thead><tbody id="lbody"></tbody></table></div>
      <div class="empty" id="empty" style="display:none"><span class="ei">üíà</span><h3 style="font-size:1rem;margin-bottom:.3rem">Keine Ergebnisse</h3><p style="font-size:.85rem">Versuche andere Filter oder Suchbegriffe.</p></div>
      <div class="pag" id="pag"></div>
    </main>
  </div>
</div>

<div class="mo" id="modal" onclick="if(event.target===this)closeModal()"><div class="mp">
  <div class="mclose"><span class="mtitle">Details</span><button onclick="closeModal()"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button></div>
  <div class="mbody" id="mbody"></div>
</div></div>

<button class="btt" id="btt" onclick="window.scrollTo({top:0,behavior:'smooth'})" title="Nach oben">‚Üë</button>

<script>
// ‚îÄ‚îÄ THEME ‚îÄ‚îÄ
(function(){var t=localStorage.getItem('zh-theme');if(t==='dark')document.documentElement.classList.add('dark')})();
function toggleTheme(){document.documentElement.classList.toggle('dark');localStorage.setItem('zh-theme',document.documentElement.classList.contains('dark')?'dark':'light')}

// ‚îÄ‚îÄ FAVORITES ‚îÄ‚îÄ
function getFavs(){try{return JSON.parse(localStorage.getItem('zh-favs-barber'))||[]}catch(e){return[]}}
function saveFavs(arr){localStorage.setItem('zh-favs-barber',JSON.stringify(arr))}
function isFav(id){return getFavs().indexOf(id)>=0}
function toggleFav(id,e){
  if(e){e.stopPropagation();e.preventDefault()}
  var favs=getFavs();var idx=favs.indexOf(id);
  if(idx>=0)favs.splice(idx,1);else favs.push(id);
  saveFavs(favs);
  document.querySelectorAll('.fav-star[data-id="'+id+'"]').forEach(function(s){s.classList.toggle('active',favs.indexOf(id)>=0);s.textContent=favs.indexOf(id)>=0?'‚òÖ':'‚òÜ'});
}

// ‚îÄ‚îÄ BACK TO TOP ‚îÄ‚îÄ
window.addEventListener('scroll',function(){var b=document.getElementById('btt');if(b)b.classList.toggle('show',window.scrollY>300)},{passive:true});

let ALL=[],FLT=[],page=1;const PER=48;let view='grid';let sort={k:'reviews',d:'desc'};
let fl={s:'',mr:4.5,mv:10,stadtZh:false,openNow:false,types:new Set()};

const TYPE_MAP={
  hair_care:{l:'Haarpflege',i:'‚úÇÔ∏è'},
  beauty_salon:{l:'Beauty Salon',i:'üíÖ'},
  spa:{l:'Spa',i:'üßñ'},
  health:{l:'Gesundheit',i:'üè•'},
  store:{l:'Shop',i:'üõçÔ∏è'}
};
const SKIP_TYPES=new Set(['point_of_interest','establishment']);

const KREIS={8001:1,8002:2,8003:3,8004:4,8005:5,8006:6,8008:8,8032:7,8037:10,8038:2,8040:4,8041:7,8044:7,8045:3,8046:6,8047:5,8048:4,8049:10,8050:11,8051:11,8052:12,8053:7,8055:3,8057:6,8058:12,8060:11,8064:9,8092:1};

// ‚îÄ‚îÄ DAY NAMES for opening hours ‚îÄ‚îÄ
const DAY_NAMES=['Sonntag','Montag','Dienstag','Mittwoch','Donnerstag','Freitag','Samstag'];

function isCurrentlyOpen(hours){
  if(!hours||!hours.length)return null;
  var now=new Date();
  var dayIdx=now.getDay();// 0=Sun
  var dayName=DAY_NAMES[dayIdx];
  var todayEntry=hours.find(function(h){return h.startsWith(dayName)});
  if(!todayEntry)return null;
  if(todayEntry.indexOf('Geschlossen')>=0)return false;
  var m=todayEntry.match(/(\d{2}):(\d{2})\s*[‚Äì\-]\s*(\d{2}):(\d{2})/);
  if(!m)return null;
  var openMin=parseInt(m[1])*60+parseInt(m[2]);
  var closeMin=parseInt(m[3])*60+parseInt(m[4]);
  var nowMin=now.getHours()*60+now.getMinutes();
  return nowMin>=openMin&&nowMin<closeMin;
}

function getTodayHours(hours){
  if(!hours||!hours.length)return'‚Äì';
  var dayIdx=new Date().getDay();
  var dayName=DAY_NAMES[dayIdx];
  var todayEntry=hours.find(function(h){return h.startsWith(dayName)});
  if(!todayEntry)return'‚Äì';
  return todayEntry.replace(dayName+': ','').replace(' Uhr','');
}

// PLZ‚Üí[lat,lng]
var PLZ_GEO={};
function buildPlzGeo(){
  var acc={};
  ALL.forEach(function(p){
    if(!p.lat||!p.lng)return;
    var m=(p.addr||'').match(/\b(\d{4})\b/);if(!m)return;var plz=m[1];
    if(!acc[plz])acc[plz]={la:0,lo:0,n:0};
    acc[plz].la+=p.lat;acc[plz].lo+=p.lng;acc[plz].n++;
  });
  Object.keys(acc).forEach(function(k){var a=acc[k];if(a.n<1)return;PLZ_GEO[k]=[Math.round(a.la/a.n*1000000)/1000000,Math.round(a.lo/a.n*1000000)/1000000]});
}
function haversine(lat1,lon1,lat2,lon2){
  if(!lat1||!lon1||!lat2||!lon2)return 99999;
  var R=6371,dLat=(lat2-lat1)*Math.PI/180,dLon=(lon2-lon1)*Math.PI/180;
  var a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)*Math.sin(dLon/2);
  return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
}
var geoOrigin=null,geoRadius=0;

function isStadtZuerich(addr){var m=(addr||'').match(/\b(80\d{2})\b/);return m!==null}
function toggleStadtZh(){fl.stadtZh=!fl.stadtZh;document.getElementById('btnStadtZh').classList.toggle('on',fl.stadtZh);page=1;apply()}
function toggleOpen(){fl.openNow=!fl.openNow;document.getElementById('btnOpen').classList.toggle('on',fl.openNow);page=1;apply()}

function positionDropdown(btnEl,menuEl){var rect=btnEl.getBoundingClientRect();menuEl.style.position='fixed';menuEl.style.top=(rect.bottom+4)+'px';var rightEdge=window.innerWidth-rect.right;menuEl.style.right=Math.max(4,rightEdge)+'px';menuEl.style.left='auto';menuEl.style.maxWidth=(window.innerWidth-8)+'px'}

function openMaps(url,lat,lng,name){
  var ua=navigator.userAgent;var isMobile=/iPhone|iPad|iPod|Android/i.test(ua);
  if(!isMobile){window.open(url,'_blank','noopener,noreferrer');return}
  var isIOS=/iPhone|iPad|iPod/i.test(ua);var isAndroid=/Android/i.test(ua);
  if(lat&&lng){
    if(isIOS){window.location.href='comgooglemaps://?q='+encodeURIComponent(name||'')+'&center='+lat+','+lng}
    else if(isAndroid){window.location.href='geo:'+lat+','+lng+'?q='+encodeURIComponent(name||'')}
    else{window.open(url,'_blank','noopener,noreferrer')}
  }else{window.open(url,'_blank','noopener,noreferrer')}
}

function syncSidebarTop(){if(window.innerWidth<=900)return;var header=document.querySelector('.header');var stats=document.querySelector('.stats');if(!header||!stats)return;var h=header.offsetHeight+stats.offsetHeight;var sidebar=document.getElementById('sidebar');if(sidebar){sidebar.style.top=h+'px';sidebar.style.maxHeight='calc(100vh - '+h+'px)'}}
window.addEventListener('resize',syncSidebarTop);
window.addEventListener('scroll',function(){document.getElementById('sortMenu').classList.remove('on')},{passive:true});

function getKreis(a){if(!a)return 0;const m=a.match(/\b(80\d{2})\b/);return m?KREIS[+m[1]]||0:0}
function kreisTag(a){const k=getKreis(a);return k?'<span class="kreis">K'+k+'</span>':''}
function xCity(a){if(!a)return'';const p=a.split(',');if(p.length<2)return a.trim();const l=p[p.length-2]?p[p.length-2].trim():'';const t=l.split(/\s+/);return t.length>=2&&/^\d{4,5}$/.test(t[0])?t.slice(1).join(' '):l}
function stars(r,sz){sz=sz||13;let h='',fu=Math.floor(r),ha=r-fu>=.25;for(let i=0;i<5;i++){if(i<fu)h+='<svg width="'+sz+'" height="'+sz+'" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>';else if(i===fu&&ha)h+='<svg width="'+sz+'" height="'+sz+'" viewBox="0 0 24 24"><defs><linearGradient id="hg'+sz+'"><stop offset="50%" stop-color="currentColor"/><stop offset="50%" stop-color="#D4DCE8"/></linearGradient></defs><path fill="url(#hg'+sz+')" d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>';else h+='<svg class="e" width="'+sz+'" height="'+sz+'" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>'}return h}
function esc(s){var d=document.createElement('div');d.textContent=s||'';return d.innerHTML}
function truncName(s,max){if(!s||s.length<=max)return s;var t=s.substring(0,max);var li=t.lastIndexOf(' ');if(li>max*0.4)t=t.substring(0,li);return t+'‚Ä¶'}
function debounce(fn,ms){var t;return function(){var a=arguments;clearTimeout(t);t=setTimeout(function(){fn.apply(null,a)},ms)}}
function fmt(n){return n.toLocaleString('de-CH')}

function s2rv(v){v=+v;if(!v)return 10;return Math.round(10+Math.pow(v/100,2)*1416)}
function rv2s(r){if(r<=10)return 0;return Math.round(Math.sqrt((r-10)/1416)*100)}

function getMapsUrl(p){
  if(p.gmaps){return p.gmaps.replace(/^https?:\/\/maps\.google\.com/,'https://www.google.com/maps')}
  if(p.id&&p.id.startsWith('ChI'))return 'https://www.google.com/maps/place/?q=place_id:'+p.id;
  if(p.lat&&p.lng)return 'https://www.google.com/maps/search/?api=1&query='+p.lat+','+p.lng;
  return 'https://www.google.com/maps/search/?api=1&query='+encodeURIComponent((p.name||'')+' '+(p.addr||''));
}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
async function init(){
  var bar=document.getElementById('pbar'),msg=document.getElementById('splashMsg');
  try{
    bar.style.width='15%';
    var resp=await fetch('barbershops_zuerich.json');
    if(!resp.ok)throw new Error('FETCH_FAIL');
    bar.style.width='40%';msg.textContent='JSON wird geparst‚Ä¶';
    var raw=await resp.json();
    processAndBoot(raw);
  }catch(err){
    if(err.message==='FETCH_FAIL'||err instanceof TypeError){
      msg.textContent='Bitte barbershops_zuerich.json manuell laden:';msg.style.opacity='1';
      document.getElementById('splashBarWrap').style.display='none';
      document.getElementById('splashSpinner').style.display='none';
      document.getElementById('splashUpload').classList.add('show');
      setupUpload();
    }else{msg.textContent='Fehler: '+err.message;msg.style.color='#FF6B6B';console.error(err)}
  }
}
function setupUpload(){
  var z=document.getElementById('dropZone'),inp=document.getElementById('fileInput');
  z.ondragover=function(e){e.preventDefault();z.classList.add('over')};
  z.ondragleave=function(){z.classList.remove('over')};
  z.ondrop=function(e){e.preventDefault();z.classList.remove('over');if(e.dataTransfer.files[0])readFile(e.dataTransfer.files[0])};
  inp.onchange=function(e){if(e.target.files[0])readFile(e.target.files[0])};
}
function readFile(file){
  var msg=document.getElementById('splashMsg'),bar=document.getElementById('pbar');
  msg.textContent='Datei wird gelesen‚Ä¶';msg.style.opacity='.6';
  document.getElementById('splashUpload').classList.remove('show');
  document.getElementById('splashSpinner').style.display='';
  document.getElementById('splashBarWrap').style.display='';bar.style.width='30%';
  var reader=new FileReader();
  reader.onload=function(e){try{processAndBoot(JSON.parse(e.target.result))}catch(err){msg.textContent='JSON Fehler: '+err.message;msg.style.color='#FF6B6B'}};
  reader.readAsText(file);
}

var idxType={};

async function processAndBoot(raw){
  var bar=document.getElementById('pbar'),msg=document.getElementById('splashMsg');
  try{
    var places=Array.isArray(raw)?raw:(raw.places||raw.results||[]);
    bar.style.width='60%';msg.textContent=fmt(places.length)+' Eintr√§ge werden verarbeitet‚Ä¶';
    await new Promise(function(r){setTimeout(r,30)});

    ALL=places.map(function(p){
      var city=xCity(p.address||'');
      var types=(p.types||[]).filter(function(t){return !SKIP_TYPES.has(t)});
      var st=[p.name,p.address].concat(types.map(function(t){return(TYPE_MAP[t]||{}).l||t})).join(' ').toLowerCase();
      return{
        id:p.place_id||'',
        name:p.name||'',
        addr:p.address||'',
        lat:p.lat||0,
        lng:p.lng||0,
        r:p.rating||0,
        rv:p.reviews||0,
        gmaps:p.google_maps_url||'',
        web:p.website||'',
        ph:p.phone||'',
        types:types,
        hours:p.opening_hours||[],
        city:city,
        searchText:st
      };
    });

    bar.style.width='75%';msg.textContent='Indizes werden aufgebaut‚Ä¶';
    await new Promise(function(r){setTimeout(r,20)});

    ALL.forEach(function(p){
      p.types.forEach(function(t){idxType[t]=(idxType[t]||0)+1});
    });

    bar.style.width='90%';msg.textContent='Interface wird aufgebaut‚Ä¶';
    await new Promise(function(r){setTimeout(r,20)});
    buildPlzGeo();buildUI();FLT=ALL.slice();
    sortFLT();render();updCount();updChips();
    bar.style.width='100%';
    await new Promise(function(r){setTimeout(r,250)});
    document.getElementById('splash').classList.add('done');document.getElementById('app').style.display='';
    setTimeout(function(){var s=document.getElementById('splash');if(s)s.remove()},600);
  }catch(err){msg.textContent='Fehler: '+err.message;msg.style.color='#FF6B6B';console.error(err)}
}

function buildUI(){
  // ‚îÄ‚îÄ Types accordion ‚îÄ‚îÄ
  var te=document.getElementById('fTypesGrid');
  var lblTypes=document.getElementById('lblTypes');
  lblTypes.addEventListener('click',function(){
    lblTypes.classList.toggle('open');
    lblTypes.nextElementSibling.classList.toggle('open');
  });
  Object.entries(idxType).sort(function(a,b){return b[1]-a[1]}).forEach(function(e){
    var info=TYPE_MAP[e[0]];if(!info)return;
    var b=document.createElement('button');
    b.className='filter-chip';b.dataset.k='types';b.dataset.v=e[0];
    b.innerHTML=info.i+' '+info.l+'<span class="chip-count">'+e[1]+'</span>';
    b.onclick=function(){togF('types',e[0],b)};te.appendChild(b);
  });

  // ‚îÄ‚îÄ Review presets ‚îÄ‚îÄ
  var rp=document.getElementById('revPresets');
  [50,100,200,500,1000].forEach(function(v){var b=mk('button','tb');b.textContent=v+'+';b.onclick=function(){var sl=document.getElementById('revSlider');sl.value=rv2s(v);onRevCount(sl.value)};rp.appendChild(b)});

  // ‚îÄ‚îÄ Geo radius buttons ‚îÄ‚îÄ
  var gr=document.getElementById('geoRadius');
  [1,2,3,5,7,10].forEach(function(km){
    var b=mk('button','tb');b.dataset.km=km;b.textContent=km+' km';
    b.onclick=function(){setGeoRadius(km)};gr.appendChild(b);
  });
  document.getElementById('geoPlz').oninput=function(){onGeoPlz(this.value)};
  buildSortMenu();
  document.getElementById('si').oninput=debounce(function(){fl.s=document.getElementById('si').value.toLowerCase().trim();page=1;apply()},300);
  syncSidebarTop();
}
function mk(tag,cls){var e=document.createElement(tag);e.className=cls;return e}
function togF(set,val,btn){
  if(fl[set].has(val)){fl[set].delete(val);if(btn)btn.classList.remove('on')}
  else{fl[set].add(val);if(btn)btn.classList.add('on')}
  page=1;apply();
}
function onRating(v){document.getElementById('ratingVal').textContent=(+v).toFixed(1);fl.mr=+v;page=1;apply()}
function onRevCount(v){var r=s2rv(v);document.getElementById('revVal').textContent=r>=1426?'1426+':''+r;fl.mv=r;page=1;apply()}
function clearAll(){
  fl={s:'',mr:4.5,mv:10,stadtZh:false,openNow:false,types:new Set()};
  document.getElementById('si').value='';
  document.getElementById('ratingSlider').value=4.5;document.getElementById('ratingVal').textContent='4.5';
  document.getElementById('revSlider').value=0;document.getElementById('revVal').textContent='10';
  document.querySelectorAll('.filter-chip.on').forEach(function(b){b.classList.remove('on')});
  document.getElementById('btnStadtZh').classList.remove('on');
  document.getElementById('btnOpen').classList.remove('on');
  clearGeo();page=1;apply();
}

// ‚îÄ‚îÄ GEO ‚îÄ‚îÄ
function onGeoPlz(val){
  var inp=document.getElementById('geoPlz');val=val.replace(/\D/g,'');inp.value=val;inp.classList.remove('ok','err');
  if(val.length===4){
    if(PLZ_GEO[val]){inp.classList.add('ok');geoOrigin={lat:PLZ_GEO[val][0],lng:PLZ_GEO[val][1],plz:val};if(geoRadius>0){page=1;apply()}updGeoStatus()}
    else{inp.classList.add('err');geoOrigin=null;if(geoRadius>0){page=1;apply()}updGeoStatus()}
  }else{geoOrigin=null;if(geoRadius>0){page=1;apply()}updGeoStatus()}
}
function setGeoRadius(km){
  document.querySelectorAll('#geoRadius .tb').forEach(function(b){b.classList.toggle('on',+b.dataset.km===km)});
  geoRadius=(geoRadius===km)?0:km;
  if(geoRadius===0){document.querySelectorAll('#geoRadius .tb').forEach(function(b){b.classList.remove('on')});if(sort.k==='distance')sort={k:'reviews',d:'desc'}}
  else if(geoOrigin){sort={k:'distance',d:'asc'}}
  buildSortMenu();page=1;apply();updGeoStatus();
}
function clearGeo(){
  geoOrigin=null;geoRadius=0;
  document.getElementById('geoPlz').value='';document.getElementById('geoPlz').classList.remove('ok','err');
  document.querySelectorAll('#geoRadius .tb').forEach(function(b){b.classList.remove('on')});
  updGeoStatus();page=1;apply();
}
function updGeoStatus(){
  var el=document.getElementById('geoStatus');
  if(geoOrigin&&geoRadius>0){el.innerHTML='<div class="geo-active">üìç PLZ '+geoOrigin.plz+' ¬∑ '+geoRadius+' km<button onclick="clearGeo()">‚úï Reset</button></div>'}else{el.innerHTML=''}
}
function getDist(p){if(!geoOrigin||!geoOrigin.lat||!geoOrigin.lng||!p.lat||!p.lng)return -1;return haversine(geoOrigin.lat,geoOrigin.lng,p.lat,p.lng)}
function distTag(p){var d=p._dist;if(d==null||d<0)return'';var txt=d<1?(Math.round(d*1000)+'m'):d.toFixed(1)+' km';return '<span class="dist"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/><circle cx="12" cy="10" r="3"/></svg>'+txt+'</span>'}

function apply(){
  FLT=ALL.filter(function(p){
    if(fl.s&&p.searchText.indexOf(fl.s)<0)return false;
    if(fl.types.size&&!p.types.some(function(t){return fl.types.has(t)}))return false;
    if(fl.stadtZh&&!isStadtZuerich(p.addr))return false;
    if(fl.openNow){var open=isCurrentlyOpen(p.hours);if(open!==true)return false}
    if(p.r<fl.mr)return false;
    if(p.rv<fl.mv)return false;
    return true;
  });
  var hasGeo=geoOrigin&&geoRadius>0;
  FLT.forEach(function(p){p._dist=geoOrigin?getDist(p):-1});
  if(hasGeo){FLT=FLT.filter(function(p){return p._dist>0&&p._dist<=geoRadius})}
  sortFLT();render();updChips();updCount();
}
function sortFLT(){
  var k=sort.k,m=sort.d==='asc'?1:-1;
  FLT.sort(function(a,b){
    if(k==='distance'){var da=a._dist>=0?a._dist:99999,db=b._dist>=0?b._dist:99999;return(da-db)*m}
    if(k==='rating')return(a.r-b.r)*m;
    if(k==='reviews')return(a.rv-b.rv)*m;
    if(k==='name'){var x=a.name.toLowerCase(),y=b.name.toLowerCase();return x<y?-m:x>y?m:0}
    return(a.rv-b.rv)*m;
  });
}
function buildSortMenu(){
  var opts=[{k:'reviews',d:'desc',l:'Meiste Bewertungen'},{k:'reviews',d:'asc',l:'Wenigste Bewertungen'},{k:'rating',d:'desc',l:'Beste Bewertung'},{k:'rating',d:'asc',l:'Schlechteste Bewertung'},{k:'name',d:'asc',l:'Name A ‚Üí Z'},{k:'name',d:'desc',l:'Name Z ‚Üí A'}];
  if(geoOrigin&&geoRadius>0)opts.unshift({k:'distance',d:'asc',l:'üìç N√§chste zuerst'},{k:'distance',d:'desc',l:'üìç Weiteste zuerst'});
  document.getElementById('sortMenu').innerHTML=opts.map(function(o){return '<button class="sopt '+(o.k===sort.k&&o.d===sort.d?'on':'')+'" onclick="setSort(\''+o.k+"','"+o.d+"')\">"+o.l+'</button>'}).join('');
}
function setSort(k,d){sort={k:k,d:d};document.getElementById('sortMenu').classList.remove('on');buildSortMenu();page=1;apply()}
function toggleSort(e){if(e)e.stopPropagation();var menu=document.getElementById('sortMenu');var wasOpen=menu.classList.contains('on');document.getElementById('sortMenu').classList.remove('on');if(!wasOpen){positionDropdown(e.currentTarget,menu);menu.classList.add('on')}}
document.addEventListener('click',function(e){if(!e.target.closest('.sdrop'))document.getElementById('sortMenu').classList.remove('on')});

function render(){if(view==='grid')renderGrid();else renderList();renderPag()}

function renderGrid(){
  var g=document.getElementById('grid'),l=document.getElementById('lview'),em=document.getElementById('empty');
  g.style.display='grid';l.style.display='none';
  if(!FLT.length){g.style.display='none';em.style.display='';return}em.style.display='none';
  var start=(page-1)*PER,slice=FLT.slice(start,start+PER);
  var favs=getFavs();
  g.innerHTML=slice.map(function(p,i){
    var globalRank=start+i+1;
    var kr=kreisTag(p.addr);
    var dt=distTag(p);
    var mapsUrl=getMapsUrl(p);
    var faved=favs.indexOf(p.id)>=0;
    var rankCls=globalRank<=3?'rank-badge top3':'rank-badge';
    var openStatus=isCurrentlyOpen(p.hours);
    var statusBadge='';
    if(openStatus===true)statusBadge='<span class="open-badge">üü¢ Offen</span>';
    else if(openStatus===false)statusBadge='<span class="closed-badge">üî¥ Geschlossen</span>';
    var todayH=getTodayHours(p.hours);
    var typeTags=p.types.slice(0,2).map(function(t){var tm=TYPE_MAP[t];return tm?'<span class="tag">'+tm.i+' '+tm.l+'</span>':''}).join('');
    return '<div class="card fade-up" style="animation-delay:'+Math.min(i*20,200)+'ms" onclick="openModal(\''+p.id+'\')">'
      +'<div class="card-header">'
        +'<div class="'+rankCls+'"># '+globalRank+'</div>'
        +statusBadge
      +'</div>'
      +'<div class="card-main-row">'
        +'<div class="card-icon">üíà</div>'
        +'<div class="card-content">'
          +'<div class="card-name">'+esc(p.name)+'</div>'
          +'<div class="card-addr"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/><circle cx="12" cy="10" r="3"/></svg><span class="card-addr-text">'+esc(p.addr)+'</span>'+kr+dt+'</div>'
          +'<div class="card-rating"><div class="stars">'+stars(p.r)+'</div><span class="card-score">'+p.r.toFixed(1)+'</span><span class="card-reviews">('+fmt(p.rv)+')</span></div>'
          +'<div style="font-size:.75rem;color:var(--text3);margin-top:.1rem">üïê Heute: '+esc(todayH)+'</div>'
        +'</div>'
      +'</div>'
      +'<div class="card-footer">'
        +'<div class="card-tags">'+typeTags+'</div>'
        +'<a class="btn-maps" href="javascript:void(0)" onclick="event.stopPropagation();openMaps(\''+esc(mapsUrl).replace(/'/g,"\\'")+'\','+(p.lat||0)+','+(p.lng||0)+',\''+esc(p.name).replace(/'/g,"\\'")+'\')">'
        +'<svg width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z" fill="#EA4335"/><circle cx="12" cy="9" r="2.5" fill="#fff"/></svg>Google Maps</a>'
      +'</div>'
      +'<span class="fav-star'+(faved?' active':'')+'" data-id="'+p.id+'" onclick="toggleFav(\''+p.id+'\',event)">'+(faved?'‚òÖ':'‚òÜ')+'</span>'
    +'</div>';
  }).join('');
}

function renderList(){
  var g=document.getElementById('grid'),l=document.getElementById('lview'),em=document.getElementById('empty');
  g.style.display='none';l.style.display='block';
  if(!FLT.length){l.style.display='none';em.style.display='';return}em.style.display='none';
  var hasGeo=geoOrigin&&geoRadius>0;
  var cols=[{k:null,l:'#'},{k:'name',l:'Name'},{k:null,l:'Adresse'},{k:null,l:'Status'},{k:'rating',l:'Bewertung'},{k:'reviews',l:'Anzahl'}];
  if(hasGeo)cols.push({k:'distance',l:'Entfernung'});
  cols.push({k:null,l:''});
  var headHTML='<tr>';
  cols.forEach(function(c){
    var sd=c.k&&c.k===sort.k;var ar=sd?(sort.d==='asc'?'‚Üë':'‚Üì'):'‚Üï';
    headHTML+='<th class="'+(sd?'sd':'')+' '+(c.k?'sort':'')+'" '+(c.k?'onclick="listSort(\''+c.k+'\')"':'')+'>'+c.l+(c.k?'<span class="sa">'+ar+'</span>':'')+'</th>';
  });
  headHTML+='</tr>';
  document.getElementById('lhead').innerHTML=headHTML;
  var start=(page-1)*PER,slice=FLT.slice(start,start+PER);
  document.getElementById('lbody').innerHTML=slice.map(function(p,i){
    var globalRank=start+i+1;
    var link=getMapsUrl(p);
    var kr=getKreis(p.addr);
    var addrD=kr?esc(p.addr.split(',')[0]||'')+' <span class="kreis">K'+kr+'</span>':esc(p.addr.split(',')[0]||'');
    var distCell='';
    if(hasGeo){var d=p._dist;distCell='<td>'+((d!=null&&d>=0)?(d<1?Math.round(d*1000)+' m':d.toFixed(1)+' km'):'‚Äì')+'</td>'}
    var openStatus=isCurrentlyOpen(p.hours);
    var statusHTML=openStatus===true?'<span class="open-badge" style="font-size:.68rem">üü¢ Offen</span>':openStatus===false?'<span class="closed-badge" style="font-size:.68rem">üî¥ Zu</span>':'<span style="color:var(--text3);font-size:.68rem">‚Äì</span>';
    return '<tr><td style="font-weight:700;color:var(--primary);text-align:center;font-size:.78rem">'+globalRank+'</td><td class="nc" onclick="openModal(\''+p.id+'\')" title="'+esc(p.name)+'">'+esc(truncName(p.name,30))+'</td><td class="ac">'+addrD+'</td><td>'+statusHTML+'</td><td><span class="stars" style="display:inline-flex;vertical-align:middle">'+stars(p.r,11)+'</span> '+p.r.toFixed(1)+'</td><td>'+fmt(p.rv)+'</td>'+distCell+'<td class="link-cell"><a href="javascript:void(0)" onclick="openMaps(\''+esc(link).replace(/'/g,"\\'")+'\','+(p.lat||0)+','+(p.lng||0)+',\''+esc(p.name).replace(/'/g,"\\'")+'\')" style="color:var(--primary);font-weight:500;font-size:.78rem">Maps ‚Üó</a></td></tr>';
  }).join('');
}

function listSort(k){if(sort.k===k)sort.d=sort.d==='asc'?'desc':'asc';else sort={k:k,d:k==='name'?'asc':'desc'};buildSortMenu();page=1;apply()}
function toggleView(){view=view==='grid'?'list':'grid';var tog=document.getElementById('viewToggle');tog.classList.toggle('list-active',view==='list');var icon=document.getElementById('vtKnobIcon');if(view==='list'){icon.innerHTML='<line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><circle cx="3.5" cy="6" r="1" fill="currentColor"/><circle cx="3.5" cy="12" r="1" fill="currentColor"/><circle cx="3.5" cy="18" r="1" fill="currentColor"/>'}else{icon.innerHTML='<rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/>'}render()}

function renderPag(){
  var tot=Math.ceil(FLT.length/PER),el=document.getElementById('pag');
  if(tot<=1){el.innerHTML='';return}
  var h='<button class="pb" '+(page===1?'disabled':'')+' onclick="goPage('+(page-1)+')">‚Äπ</button>';
  var rng=[];if(tot<=7){for(var i=1;i<=tot;i++)rng.push(i)}else{rng.push(1);if(page>3)rng.push('‚Ä¶');for(var j=Math.max(2,page-1);j<=Math.min(tot-1,page+1);j++)rng.push(j);if(page<tot-2)rng.push('‚Ä¶');rng.push(tot)}
  rng.forEach(function(p){if(p==='‚Ä¶')h+='<span class="pi">‚Ä¶</span>';else h+='<button class="pb '+(p===page?'on':'')+'" onclick="goPage('+p+')">'+p+'</button>'});
  h+='<button class="pb" '+(page===tot?'disabled':'')+' onclick="goPage('+(page+1)+')">‚Ä∫</button>';
  h+='<span class="pi">'+(((page-1)*PER)+1)+'‚Äì'+Math.min(page*PER,FLT.length)+' von '+fmt(FLT.length)+'</span>';
  el.innerHTML=h;
}
function goPage(p){page=p;render();window.scrollTo({top:160,behavior:'smooth'})}
function updCount(){document.getElementById('rcnt').innerHTML='<b>'+fmt(FLT.length)+'</b> von '+fmt(ALL.length)+' Herrencoiffeuren'}

function updChips(){
  var el=document.getElementById('chips');
  while(el.firstChild)el.removeChild(el.firstChild);
  var count=0;
  function addChip(label,action){
    count++;
    var span=document.createElement('span');span.className='chip';
    span.appendChild(document.createTextNode(label+' '));
    var btn=document.createElement('button');btn.className='chip-x';btn.textContent='‚úï';
    btn.addEventListener('click',function(e){e.stopPropagation();action();page=1;apply()});
    span.appendChild(btn);
    el.appendChild(span);
  }
  if(fl.s)addChip('"'+fl.s+'"',function(){fl.s='';document.getElementById('si').value=''});
  if(fl.openNow)addChip('üü¢ Jetzt ge√∂ffnet',function(){fl.openNow=false;document.getElementById('btnOpen').classList.remove('on')});
  if(fl.stadtZh)addChip('üèôÔ∏è Stadt Z√ºrich',function(){fl.stadtZh=false;document.getElementById('btnStadtZh').classList.remove('on')});
  fl.types.forEach(function(t){var tm=TYPE_MAP[t];addChip((tm?tm.i:'')+' '+(tm?tm.l:t),function(){togF('types',t,document.querySelector('[data-k="types"][data-v="'+t+'"]'))})});
  if(fl.mr>4.5)addChip('‚â•'+fl.mr.toFixed(1)+'‚òÖ',function(){fl.mr=4.5;document.getElementById('ratingSlider').value=4.5;document.getElementById('ratingVal').textContent='4.5'});
  if(fl.mv>10)addChip('‚â•'+fl.mv+' Bew.',function(){fl.mv=10;document.getElementById('revSlider').value=0;document.getElementById('revVal').textContent='10'});
  if(geoOrigin&&geoRadius>0){addChip('üìç PLZ '+geoOrigin.plz+' ¬∑ '+geoRadius+' km',function(){clearGeo()})}
  if(count>1){var clr=document.createElement('button');clr.className='chip-clear';clr.textContent='Alle ‚úï';clr.addEventListener('click',function(){clearAll()});el.appendChild(clr)}
}

// ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ
function openModal(id){
  var p=ALL.find(function(x){return x.id===id});if(!p)return;
  var bd=document.getElementById('mbody');
  var link=getMapsUrl(p);
  var kr=kreisTag(p.addr);
  var openStatus=isCurrentlyOpen(p.hours);
  var statusHTML='';
  if(openStatus===true)statusHTML='<span class="open-badge" style="font-size:.85rem">üü¢ Jetzt ge√∂ffnet</span>';
  else if(openStatus===false)statusHTML='<span class="closed-badge" style="font-size:.85rem">üî¥ Geschlossen</span>';

  var mdist='';
  if(geoOrigin&&p._dist>=0){var d=p._dist;mdist='<div class="m-row" style="color:var(--gold);font-weight:600"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/><circle cx="12" cy="10" r="3"/></svg>'+(d<1?Math.round(d*1000)+' m':d.toFixed(1)+' km')+' von PLZ '+geoOrigin.plz+'</div>'}

  var typeTags=p.types.map(function(t){var tm=TYPE_MAP[t];return tm?'<span class="tag" style="font-size:.72rem">'+tm.i+' '+tm.l+'</span>':''}).join('');

  // Opening hours
  var hoursHTML='';
  if(p.hours&&p.hours.length){
    var todayName=DAY_NAMES[new Date().getDay()];
    hoursHTML='<ul class="hours-list">';
    p.hours.forEach(function(h){
      var isToday=h.startsWith(todayName);
      hoursHTML+='<li class="'+(isToday?'today':'')+'">'+esc(h)+'</li>';
    });
    hoursHTML+='</ul>';
  }

  bd.innerHTML='<div class="m-name">üíà '+esc(p.name)+'</div>'
    +'<div style="display:flex;align-items:center;gap:.5rem;margin-bottom:.75rem;flex-wrap:wrap">'
    +'<div class="stars" style="color:var(--gold)">'+stars(p.r,17)+'</div>'
    +'<span style="font-weight:700;font-size:1.05rem">'+p.r.toFixed(1)+'</span>'
    +'<span style="color:var(--text3);font-size:.88rem">('+fmt(p.rv)+' Bewertungen)</span>'
    +statusHTML
    +'</div>'
    +'<div class="m-sec"><h4>Details</h4>'
    +'<div class="m-row"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/><circle cx="12" cy="10" r="3"/></svg>'+esc(p.addr)+' '+kr+'</div>'
    +mdist
    +(p.ph?'<div class="m-row"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72c.127.96.361 1.903.7 2.81a2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0122 16.92z"/></svg><a href="tel:'+p.ph+'" style="color:var(--primary);font-weight:500">'+esc(p.ph)+'</a></div>':'')
    +(p.web?'<div class="m-row"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"/></svg><a href="'+p.web+'" target="_blank" rel="noopener" style="color:var(--primary);font-weight:500;word-break:break-all">'+p.web.replace(/^https?:\/\/(www\.)?/,'').substring(0,45)+'</a></div>':'')
    +'</div>'
    +(hoursHTML?'<div class="m-sec"><h4>√ñffnungszeiten</h4>'+hoursHTML+'</div>':'')
    +'<div class="m-sec"><h4>Services</h4><div style="display:flex;flex-wrap:wrap;gap:.25rem">'+typeTags+'</div></div>'
    +'<div class="m-cta">'
    +(link?'<a href="javascript:void(0)" onclick="openMaps(\''+esc(link).replace(/'/g,"\\'")+'\','+(p.lat||0)+','+(p.lng||0)+',\''+(p.name||'').replace(/'/g,"\\'")+'\')" class="btn-p">üìç Auf Google Maps</a>':'')
    +(p.web?'<a href="'+p.web+'" target="_blank" rel="noopener" class="btn-s">üåê Website besuchen</a>':'')
    +(p.ph?'<a href="tel:'+p.ph+'" class="btn-s">üìû Anrufen</a>':'')
    +'</div>';
  document.getElementById('modal').classList.add('on');document.body.style.overflow='hidden';
}
function closeModal(){document.getElementById('modal').classList.remove('on');document.body.style.overflow=''}
document.addEventListener('keydown',function(e){if(e.key==='Escape')closeModal()});
function toggleMF(){document.getElementById('sidebar').classList.toggle('open');document.getElementById('fov').classList.toggle('on')}

init();
</script>
</body>
</html>
